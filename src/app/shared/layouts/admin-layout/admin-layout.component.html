<!-- Admin Layout - PARIDAD: Rails admin.html.erb -->
<div class="admin-layout" [class.sidebar-collapsed]="sidebarCollapsed()" [class.whatsapp-visible]="whatsappVisible()">
  <!-- Update Banner - Shows when app update is available -->
  <app-update-banner />

  <!-- Impersonation Toolbar - PARIDAD: Rails _admin_login_as_toolbar.html.erb -->
  <app-impersonation-toolbar />

  <!-- Sidebar -->
  <app-sidebar
    [collapsed]="sidebarCollapsed()"
    [mobileOpen]="sidebarMobileOpen()"
    (close)="closeMobileSidebar()"
    (toggleCollapse)="toggleSidebarCollapse()"
  />

  <!-- Main wrapper -->
  <div class="main-wrapper">
    <!-- Header -->
    <app-header (toggleSidebar)="toggleSidebar()" />

    <!-- Main content -->
    <main class="main-content">
      <router-outlet />
    </main>

    <!-- Footer -->
    <footer class="main-footer">
      <div class="footer-left">
        <span>Monitor WhatsApp Service &copy; {{ currentYear }}</span>
      </div>
      <div class="footer-right">
        <a href="/help" class="footer-link">Ayuda</a>
        <span class="footer-divider">|</span>
        <a href="/privacy" class="footer-link">Privacidad</a>
        <span class="footer-divider">|</span>
        <a href="/terms" class="footer-link">Términos</a>
      </div>
    </footer>
  </div>

  <!-- Bulk Send Overlay - blocks ALL interaction during mass sending -->
  @if (bulkSendActive()) {
    <div class="bulk-send-overlay">
      <div class="bulk-send-card">
        <div class="bulk-send-icon">
          <i class="ph ph-paper-plane-tilt"></i>
        </div>
        <h3>Envío masivo en curso</h3>
        <p class="bulk-send-phone">{{ bulkSendState().currentPhone || 'Preparando...' }}</p>
        <div class="bulk-send-progress-bar">
          <div class="bulk-send-progress-fill" [style.width.%]="bulkSendProgress"></div>
        </div>
        <p class="bulk-send-count">
          {{ bulkSendState().sentCount }} / {{ bulkSendState().totalRecipients }} enviados
          @if (bulkSendState().failedCount > 0) {
            <span class="bulk-send-failed">({{ bulkSendState().failedCount }} fallidos)</span>
          }
        </p>
        <div class="bulk-send-actions">
          <button class="bulk-send-btn bulk-send-btn-pause" (click)="pauseBulkSend()">
            <i class="ph ph-pause"></i> Pausar
          </button>
          <button class="bulk-send-btn bulk-send-btn-cancel" (click)="cancelBulkSend()">
            <i class="ph ph-x"></i> Cancelar
          </button>
        </div>
        <p class="bulk-send-notice">La interfaz está bloqueada durante el envío masivo</p>
      </div>
    </div>
  }

  <!-- Toast Container -->
  <div class="toast-container">
    @for (toast of toasts(); track toast.id) {
      <div class="toast toast-{{ toast.type }}" (click)="dismissToast(toast.id)">
        <i class="ph {{ getToastIcon(toast.type) }}"></i>
        <span>{{ toast.message }}</span>
        <button type="button" class="toast-close" aria-label="Cerrar">
          <i class="ph ph-x"></i>
        </button>
      </div>
    }
  </div>
</div>
